(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var o=n(166),r=n(51),c=(n(170),n(14),n(159)),u=n(25),i=n(94),a=n(3),s=n(459),l=n(460);function p(t){return Object(a.q)((function(e){return{type:"SPEAK",value:t}}))}var d={"Future.":{question1:"Correct"},"The future.":{question1:"Correct"},"Promise.":{question2:"Well done!"},"A promise.":{question2:"Well done!"},"Secret.":{question3:"That's correct."},"A secret.":{question3:"That's correct."},"My name.":{question4:"Correct"},"Your name.":{question4:"Correct"},"Mirror.":{question5:"Correct"},"A mirror.":{question5:"Correct"}},E={"Yes.":{yes_no:"yes"},"Of course.":{yes_no:"yes"},"Sure.":{yes_no:"yes"},"Absolutely.":{yes_no:"yes"},"No.":{yes_no:"no"},"No way.":{yes_no:"no"},"Of course not.":{yes_no:"no"},"Absolutely not.":{yes_no:"no"},"Help me.":{help:"help"},"Help.":{help:"help"},"I would like to help me":{help:"help"}},f={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"Hello",CLICK:"Hello"}},Help:{initial:"help_message",states:{help_message:{entry:p("Welcome to the riddles. It is a mini game with 5 questions. In the first three questions you have two chances to answer if you make a mistake. If you want to win you have to answer all the questions correctly. Good luck!  "),on:{ENDSPEECH:"#root.dm.Hello.hist"}}}},Hello:{initial:"Hej",states:{hist:{type:"history"},Hej:{initial:"prompt0",entry:Object(a.b)({counter:function(t){return t.counter=0}}),on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"begin",actions:Object(a.b)({username:function(t){return t.recResult[0].utterance}})},{target:".nomatch"}],TIMEOUT:[{target:".prompt0",cond:function(t){return 0===t.counter}},{target:".prompt1",cond:function(t){return 1===t.counter}},{target:"#root.dm.init",cond:function(t){return 2===t.counter}}]},states:{hist:{type:"history"},prompt0:{entry:[p("What is your name?"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask"}},prompt1:{entry:[p("could you say your name?"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask"}},ask:{entry:Object(a.q)("LISTEN")},nomatch:{entry:p("Sorry, could you repeat?"),on:{ENDSPEECH:"ask"}}}},begin:{initial:"prompt",entry:Object(a.b)({counter:function(t){return t.counter=0}}),on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"game_starts",cond:function(t){return"yes_no"in(E[t.recResult[0].utterance]||{})&&"yes"===E[t.recResult[0].utterance].yes_no}},{target:"Hej",cond:function(t){return"yes_no"in(E[t.recResult[0].utterance]||{})&&"no"===E[t.recResult[0].utterance].yes_no}},{target:".nomatch"}],TIMEOUT:[{target:".prompt",cond:function(t){return 0===t.counter}},{target:"#root.dm.init",cond:function(t){return 1===t.counter}}]},states:{prompt:{entry:Object(a.q)((function(t){return{type:"SPEAK",value:"Hi ".concat(t.username)}})),on:{ENDSPEECH:"ask"}},ask:{entry:[p("Would you like to play a game?"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"yo"}},yo:{entry:Object(a.q)("LISTEN")},nomatch:{entry:p("Sorry, I didn't understand that."),on:{ENDSPEECH:"ask"}}}},game_starts:{initial:"prompt0",entry:Object(a.b)({counter:function(t){return t.counter=0}}),on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"question2",cond:function(t){return"question1"in(d[t.recResult[0].utterance]||{})},actions:Object(a.b)((function(t){return{question1:d[t.recResult[0].utterance].question1}}))},{target:".nomatch",cond:function(t){return 1===t.counter}},{target:".nomatch1",cond:function(t){return 2===t.counter}}],TIMEOUT:[{target:".prompt0",cond:function(t){return 0===t.counter}},{target:".prompt1",cond:function(t){return 1===t.counter}},{target:"#root.dm.init",cond:function(t){return 2===t.counter}}]},states:{prompt0:{entry:[p("Ok, let's start with the first question. What is always in front of you but can't be seen?"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask1"}},prompt1:{entry:[p("What is always in front of you but can't be seen?"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask2"}},ask1:{entry:Object(a.q)("LISTEN")},ask2:{entry:Object(a.q)("LISTEN")},nomatch:{entry:[p("Sorry, your answer is wrong! You have one more chance."),Object(a.b)({counter:function(t){return t.counter}})],on:{ENDSPEECH:"prompt1"}},nomatch1:{entry:[p("Your answer is wrong!"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"loose"}},loose:{entry:p("sorry, you have lost!")}}},question2:{initial:"prompt0",on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"question3",cond:function(t){return"question2"in(d[t.recResult[0].utterance]||{})},actions:Object(a.b)((function(t){return{question2:d[t.recResult[0].utterance].question2}}))},{target:".nomatch",cond:function(t){return 1===t.counter}},{target:".nomatch1",cond:function(t){return 2===t.counter}}],TIMEOUT:[{target:".prompt0",cond:function(t){return 0===t.counter}},{target:".prompt1",cond:function(t){return 1===t.counter}},{target:"#root.dm.init",cond:function(t){return 2===t.counter}}]},states:{prompt0:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:"You have answered ".concat(t.question1," the first question. Let's move on on the second. What can you break, even if you never pick it up or touch it?")}})),Object(a.b)({counter:function(t){return t.counter}})],on:{ENDSPEECH:"ask1"}},prompt1:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:" What can you break, even if you never pick it up or touch it?"}})),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask2"}},ask1:{entry:Object(a.q)("LISTEN")},ask2:{entry:Object(a.q)("LISTEN")},nomatch:{entry:[p("Sorry you have answered incorrectly! Try again!"),Object(a.b)({counter:function(t){return t.counter}})],on:{ENDSPEECH:"prompt1"}},nomatch1:{entry:[p("You have answered incorrectly!"),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"loose1"}},loose1:{entry:p("sorry, you have lost!")}}},question3:{initial:"prompt0",on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"question4",cond:function(t){return"question3"in(d[t.recResult[0].utterance]||{})},actions:Object(a.b)((function(t){return{question3:d[t.recResult[0].utterance].question3}}))},{target:".nomatch",cond:function(t){return 1===t.counter}},{target:".nomatch1",cond:function(t){return 2===t.counter}}],TIMEOUT:[{target:".prompt0",cond:function(t){return 0===t.counter}},{target:".prompt1",cond:function(t){return 1===t.counter}},{target:"#root.dm.init",cond:function(t){return 2===t.counter}}]},states:{prompt0:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:" ".concat(t.question2,". Question3. If you've got me, you want to share me; if you share me, you haven't kept me. What am I?")}})),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask1"}},prompt1:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:" If you've got me, you want to share me; if you share me, you haven't kept me. What am I?"}})),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask2"}},ask1:{entry:Object(a.q)("LISTEN")},ask2:{entry:Object(a.q)("LISTEN")},nomatch:{entry:[p("The answer is wrong! Listen to the question one more time."),Object(a.b)({counter:function(t){return t.counter}})],on:{ENDSPEECH:"prompt1"}},nomatch1:{entry:[p("The answer is wrong!"),Object(a.b)({counter:function(t){return t.counter}})],on:{ENDSPEECH:"loose2"}},loose2:{entry:p("sorry, you have lost!")}}},question4:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"question5",cond:function(t){return"question4"in(d[t.recResult[0].utterance]||{})},actions:Object(a.b)((function(t){return{question4:d[t.recResult[0].utterance].question4}}))},{target:".nomatch"}]},states:{prompt:{entry:Object(a.q)((function(t){return{type:"SPEAK",value:"".concat(t.question3," .For the rest two answers you have only one chance to answer correct. So, let's move on. Question 4. It belongs to you, but other people use it more than you do. What is it?")}})),on:{ENDSPEECH:"ask"}},ask:{entry:Object(a.q)("LISTEN")},nomatch:{entry:p("Sorry you have lost.")}}},question5:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.Help",cond:function(t){return"help"in(E[t.recResult[0].utterance]||{})}},{target:"Win",cond:function(t){return"question5"in(d[t.recResult[0].utterance]||{})},actions:Object(a.b)((function(t){return{question5:d[t.recResult[0].utterance].question5}}))},{target:".nomatch"}]},states:{prompt:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:"You have answered ".concat(t.question4," the fourth question. And now it's time for the last one. If you drop me I'm sure to crack, but give me a smile and I'll always smile back. What am I?")}})),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask"}},prompt1:{entry:[Object(a.q)((function(t){return{type:"SPEAK",value:" What can you break, even if you never pick it up or touch it?"}})),Object(a.b)({counter:function(t){return t.counter+1}})],on:{ENDSPEECH:"ask"}},ask:{entry:Object(a.q)("LISTEN")},nomatch:{entry:p("Sorry you have answered incorrectly! You have lost!")}}},Win:{initial:"prompt",states:{prompt:{entry:p("Congratulations, you have won!")}}}}}}},m=n(160),y=n.n(m),h=n(163),b=n.n(h),S=n(12),O=u.a.send,g=u.a.cancel,T="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var j=Object(i.a)({id:"root",type:"parallel",states:{dm:Object(r.a)({},f),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(a.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return k()},onDone:{actions:[Object(a.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var o=b()({audioContext:t.audioCtx,credentials:{region:T,authorizationToken:t.azureAuthorizationToken}}),r=o.speechSynthesis,c=o.SpeechSynthesisUtterance;t.tts=r,t.ttsUtterance=c,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),o=RegExp("en-US","u");o=RegExp("en-US","u");var r=n.find((function(t){return o.test(t.name)}));r?(t.voice=r,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(a.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(a.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause"},states:{noinput:{entry:["recStart",O({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||10)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:g("timeout")},inprogress:{},match:{entry:O("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:O("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),v=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,o="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):o="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):o="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",o="circle-click";break;default:e=e||"\xa0"}return Object(S.jsxs)("div",{className:"control",children:[Object(S.jsx)("figure",{className:"prompt",children:n&&Object(S.jsx)("img",{src:n,alt:e})}),Object(S.jsxs)("div",{className:"status",children:[Object(S.jsx)("button",Object(r.a)({type:"button",className:o,style:{}},t)),Object(S.jsx)("div",{className:"status-text",children:e})]})]})},C=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(S.jsxs)("figure",Object(r.a)(Object(r.a)({className:"flex"},t),{},{children:[n&&Object(S.jsx)("img",{src:n,alt:e}),Object(S.jsx)("figcaption",{children:e})]}))};function R(){var t=Object(s.b)(j,{devTools:!0,actions:{changeColour:Object(s.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(s.a)((function(t){t.asr.start()})),recStop:Object(s.a)((function(t){t.asr.abort()})),ttsStart:Object(s.a)((function(t){var e='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="http://www.w3.org/2001/mstts" xml:lang="en-US"><voice name="'.concat(t.voice.name,'">');e+=Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"f1ad7428d15d41e99d1dc3de01674625",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON?'<lexicon uri="'.concat(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"f1ad7428d15d41e99d1dc3de01674625",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON,'"/>'):"",e+="".concat(t.ttsAgenda,"</voice></speak>"),console.debug(e);var n=new t.ttsUtterance(e);console.log("S>",t.ttsAgenda),n.voice=t.voice,n.onend=function(){return r("ENDSPEECH")},t.tts.speak(n)})),ttsStop:Object(s.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(s.a)((function(t,e){var n=y()({audioContext:t.audioCtx,credentials:{region:T,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?r({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):r({type:"STARTSPEECH"})}}))}}),e=Object(o.a)(t,2),n=e[0],r=e[1],c=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(S.jsx)(C,{state:n,alternative:t.visual_information,onClick:function(){return r({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(S.jsxs)("div",{className:"App",children:[Object(S.jsx)(v,{state:n,alternative:{},onClick:function(){return r("CLICK")}}),Object(S.jsx)("div",{className:"select-wrapper",children:Object(S.jsx)("div",{className:"select",children:c})})]})}var k=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"f1ad7428d15d41e99d1dc3de01674625"}})).then((function(t){return t.text()}))},N=document.getElementById("root");c.render(Object(S.jsx)(R,{}),N)}},[[456,1,2]]]);
//# sourceMappingURL=main.5682ca0c.chunk.js.map